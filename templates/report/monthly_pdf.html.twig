<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Monthly Report</title>
    <style>
        body { font-family: 'Arial', sans-serif; color: #1F2937; line-height: 1.5; font-size: 14px; }
        .header { margin-bottom: 30px; border-bottom: 2px solid #E5E7EB; padding-bottom: 20px; }
        .logo { max-height: 40px; margin-bottom: 10px; }
        .title { font-size: 24px; font-weight: bold; color: #111827; margin: 0; }
        .subtitle { font-size: 14px; color: #6B7280; margin-top: 5px; }
        
        .section { margin-bottom: 30px; page-break-inside: avoid; }
        .section-title { font-size: 18px; font-weight: bold; color: #111827; border-bottom: 1px solid #E5E7EB; padding-bottom: 5px; margin-bottom: 15px; }
        
        .grid { width: 100%; border-collapse: separate; border-spacing: 10px; margin: 0 -10px; }
        .card { background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 4px; padding: 15px; width: 30%; text-align: center; float: left; margin-right: 3%; box-sizing: border-box; }
        .card:last-child { margin-right: 0; }
        
        .metric-value { font-size: 24px; font-weight: bold; color: #1F2937; margin: 5px 0; }
        .metric-label { font-size: 12px; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; }
        .metric-trend { font-size: 12px; font-weight: bold; margin-top: 5px; }
        .positive { color: #10B981; }
        .negative { color: #EF4444; }
        
        .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .table th, .table td { text-align: left; padding: 10px; border-bottom: 1px solid #E5E7EB; }
        .table th { background-color: #F3F4F6; font-size: 12px; text-transform: uppercase; color: #6B7280; }
        
        .exec-summary { background: #EFF6FF; border: 1px solid #BFDBFE; color: #1E40AF; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        
        /* Clearfix */
        .clearfix::after { content: ""; clear: both; display: table; }

        .bar-container { background: #E5E7EB; height: 10px; width: 100%; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; background: #3B82F6; }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">Monthly Helpdesk Report</div>
        <div class="subtitle">Reporting Period: {{ period }}</div>
    </div>

    <!-- 1. Executive Summary -->
    <div class="section">
        <div class="section-title">1. Executive Summary</div>
        <div class="exec-summary">
            {{ summary }}
        </div>
    </div>

    <!-- 2. Volume Metrics -->
    <div class="section clearfix">
        <div class="section-title">2. Volume Metrics (Workload)</div>
        <div class="card">
            <div class="metric-label">Total New Tickets</div>
            <div class="metric-value">{{ volume.new }}</div>
            <div class="metric-trend {{ volume_comparison >= 0 ? 'positive' : 'negative' }}">
                {{ volume_comparison >= 0 ? '▲ +' : '▼ ' }}{{ volume_comparison }}% vs Prev
            </div>
        </div>
        <div class="card">
            <div class="metric-label">Total Resolved</div>
            <div class="metric-value">{{ volume.resolved }}</div>
        </div>
        <div class="card">
            <div class="metric-label">Backlog Growth</div>
            <div class="metric-value" style="color: {{ volume.backlog_growth > 0 ? '#EF4444' : '#10B981' }}">
                {{ volume.backlog_growth > 0 ? '+' : '' }}{{ volume.backlog_growth }}
            </div>
        </div>
    </div>

    <!-- 3. Efficiency Metrics -->
    <div class="section clearfix" style="margin-top: 30px;">
        <div class="section-title">3. Efficiency Metrics</div>
        <div class="card">
            <div class="metric-label">Avg Resolution Time</div>
            <div class="metric-value">{{ efficiency.avg_resolution_hours }} hrs</div>
        </div>
        <div class="card">
            <div class="metric-label">First Response Time</div>
            <div class="metric-value">-</div> <!-- Placeholder as planned -->
        </div>
        <div class="card">
            <div class="metric-label">SLA Breach Rate</div>
            <div class="metric-value" style="color: {{ efficiency.sla_breach_rate > 10 ? '#EF4444' : '#10B981' }}">
                {{ efficiency.sla_breach_rate }}%
            </div>
        </div>
    </div>

    <!-- 4. Categorization -->
    <div class="section">
        <div class="section-title">4. Categorization & Trends</div>
        <table class="table" style="width: 48%; float: left;">
            <thead>
                <tr>
                    <th colspan="2">Top 3 Categories</th>
                </tr>
            </thead>
            <tbody>
                {% for cat in categories %}
                <tr>
                    <td>{{ cat.label }}</td>
                    <td style="text-align: right; font-weight: bold;">{{ cat.count }}</td>
                </tr>
                {% else %}
                <tr><td colspan="2">No data available</td></tr>
                {% endfor %}
            </tbody>
        </table>
        
        <table class="table" style="width: 48%; float: right;">
            <thead>
                <tr>
                    <th colspan="2">Priority Breakdown</th>
                </tr>
            </thead>
            <tbody>
                {% for prio in priorities %}
                <tr>
                    <td>{{ prio.label }}</td>
                    <td style="text-align: right; width: 50px;">
                        {{ prio.count }}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="2">No data available</td></tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="clearfix"></div>
    </div>

    <!-- 5. Team Performance -->
    <div class="section">
        <div class="section-title">5. Team Performance</div>
        <table class="table">
            <thead>
                <tr>
                    <th>Technician</th>
                    <th>Tickets Solved</th>
                    <th style="width: 60%;">Performance</th>
                </tr>
            </thead>
            <tbody>
                {% set max_score = 1 %}
                {% for t in team %}
                    {% set max_score = max(max_score, t.count) %}
                {% endfor %}

                {% for member in team %}
                <tr>
                    <td style="font-weight: bold;">{{ member.name }}</td>
                    <td>{{ member.count }}</td>
                    <td>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: {{ (member.count / max_score) * 100 }}%"></div>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="3">No resolved tickets this month.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div style="text-align: center; color: #9CA3AF; margin-top: 50px; font-size: 12px;">
        Generated on {{ 'now'|date('F d, Y H:i') }}
    </div>
</body>
</html>
