<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genesys Helpdesk | Dashboard</title>
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
</head>
<body>
    <div class="app-container">
        
        {{ include('partials/_sidebar.html.twig') }}

        <main class="main-content">
            <div style="width: 100%; max-width: 1200px;">
                
                <div style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.8rem; margin: 0; color: #0F172A;">Dashboard Overview</h2>
                    <p style="color: #64748B; margin-top: 0.5rem;">Welcome back, Admin. Here is what's happening today.</p>
                </div>

                <div class="dashboard-grid">

                    <div class="stat-card">
                        <div class="stat-icon bg-blue-soft">üé´</div>
                        <div class="stat-info">
                            <h4>Total Tickets</h4>
                            <span>{{ totalTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-purple-soft">üì•</div>
                        <div class="stat-info">
                            <h4>Incoming Tickets</h4>
                            <span>{{ incomingTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-orange-soft">‚è≥</div>
                        <div class="stat-info">
                            <h4>Pending Tickets</h4>
                            <span>{{ pendingTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-blue-soft">üë§</div>
                        <div class="stat-info">
                            <h4>Assigned Tickets</h4>
                            <span>{{ assignedTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-purple-soft">üìÖ</div>
                        <div class="stat-info">
                            <h4>Planned Tickets</h4>
                            <span>{{ plannedTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-emerald-soft">‚úÖ</div>
                        <div class="stat-info">
                            <h4>Solved Tickets</h4>
                            <span>{{ solvedTickets }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-emerald-soft">üîí</div>
                        <div class="stat-info">
                            <h4>Closed Tickets</h4>
                            <span>{{ closedTickets }}</span>
                        </div>
                    </div>

                </div>
                <div class="card">
                    <div class="card-header" style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                        <h3 class="card-title" style="font-size: 1.25rem;">Recent Tickets</h3>
                        <a href="{{ path('app_ticket_create') }}" style="font-size: 0.875rem; color: #3B82F6; text-decoration: none; font-weight: 600;">+ New Ticket</a>
                    </div>
                    
                    <div class="table-container">
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>Ticket ID</th>
                                    <th>Subject</th>
                                    <th>Assigned To</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ticket in recentTickets %}
                                    {% set statusLabel = ticket.status_label ?? 'Open' %}
                                    {% set statusClass = statusLabel|lower in ['resolved', 'closed'] ? 'status-closed' : 'status-open' %}
                                    <tr>
                                        <td>#T-{{ ticket.id }}</td>
                                        <td>{{ ticket.title }}</td>
                                        <td>{{ ticket.assignee_name ?? 'Unassigned' }}</td>
                                        <td>{{ ticket.created_at|date('M d, Y H:i') }}</td>
                                        <td><span class="status-badge {{ statusClass }}">{{ statusLabel }}</span></td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="5">No tickets yet.</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>
</body>
</html>
